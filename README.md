# WG AVTO BOT

## Обновление и проверки

- Локальная проверка перед деплоем:
  - `./scripts/ci_check.sh`
- Безопасное обновление на сервере:
  - `./scripts/update.sh`

`update.sh` делает следующее:

1. Проверяет наличие `python3.11`.
2. Сохраняет текущий commit как точку отката.
3. Обновляет код на `origin/main`.
4. Пересоздаёт `.venv` на Python 3.11 при необходимости и ставит зависимости (`pip install -e .`).
5. Запускает quality-gate через `./scripts/ci_check.sh` (`compileall`, `pip check`, импорт `app.main`).
6. Выполняет инициализацию/миграцию БД.
7. Рестартует `wg-avto-bot` и проверяет, что сервис `active`.
8. При любой ошибке выполняет rollback на предыдущий commit и пытается вернуть сервис в рабочее состояние.

Если обновление упало — смотрите логи, которые печатает `update.sh`, и `journalctl -u wg-avto-bot -n 80`.
